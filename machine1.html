<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IMAGE MACHINE</title>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="theme-color" content="#000000">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M6PMRQR437"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-M6PMRQR437');
  </script>
  
  <style>
    /* 基本スタイル */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    
    /* 横スクロールコンテナ */
    .scroll-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      display: flex;
      align-items: center;
      justify-content: flex-start; /* 左揃えに変更 */
      z-index: 1;
    }

    /* 画像のスタイル */
    #main-img {
      width: auto;
      height: 100vh;
      min-width: 100vw;
      object-fit: cover;
      flex-shrink: 0;
      transition: opacity 0.3s ease-in-out;
    }

    /* UI要素のレイヤー */
    .ui-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none; /* 下の要素を操作可能に */
    }
    .ui-layer > * {
      pointer-events: auto; /* UI要素自体は操作可能に */
    }
    
    /* UI要素の具体的なスタイル */
    .top-left-ui {
      position: absolute;
      top: 1rem;
      left: 1rem;
    }
    .bottom-center-ui {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .regenerate-button {
        color: white;
        font-size: 1.25rem;
        font-weight: 300;
        letter-spacing: 0.1em;
        background-color: rgba(0, 0, 0, 0.3);
        padding: 0.75rem 1.5rem;
        border-radius: 9999px;
        transition: all 0.2s ease-in-out;
    }
    .regenerate-button:hover {
        background-color: rgba(0, 0, 0, 0.5);
    }
    .text-shadow {
      text-shadow: 0 0 8px rgba(0,0,0,0.7);
    }
  </style>

</head>
<body>

  <div class="scroll-container">
    <img id="main-img" src="" alt="Generative Art">
  </div>

  <div class="ui-layer">
    <div class="top-left-ui">
      <a href="/" class="text-white text-lg hover:opacity-75 transition-opacity text-shadow">← Back</a>
    </div>

    <div class="bottom-center-ui">
      <button onclick="changeBackground()" class="regenerate-button text-shadow">REGENERATE</button>
      <footer class="mt-4">
        <p class="text-white text-shadow" style="font-size: 10px; font-family: Verdana, sans-serif;">©︎GENERATIVE JUNKIE</p>
      </footer>
    </div>
  </div>

  <script>
    // --- 画像ファイル名のリスト ---
    // ここに394枚すべてのファイル名を追加するのが理想ですが、まずは動作確認のため一部を記載します。
    // 問題なく動作することが確認できたら、このリストを完全なものにしてください。
    const imageFiles = [
        "photo001.webp", "photo002.webp", "photo003.webp",
        "photo004.webp", "photo005.webp", "photo006.webp",
        "photo007.webp", "photo008.webp", "photo009.webp",
        "photo010.webp", "photo011.webp", "photo012.webp",
        "photo013.webp", "photo014.webp", "photo015.webp",
        "photo016.webp", "photo017.webp", "photo018.webp",
        "photo019.webp", "photo020.webp", "photo021.webp",
        "photo022.webp", "photo023.webp", "photo024.webp",
        "photo025.webp", "photo026.webp", "photo027.webp",
        "photo028.webp", "photo029.webp", "photo030.webp",
        "photo031.webp"
    ];

    const mainImg = document.getElementById('main-img');
    const scrollContainer = document.querySelector('.scroll-container');
    let currentIndex = -1; // -1に初期化

    function changeBackground() {
        if (imageFiles.length === 0) return;

        let newIndex = Math.floor(Math.random() * imageFiles.length);
        while (newIndex === currentIndex && imageFiles.length > 1) {
            newIndex = Math.floor(Math.random() * imageFiles.length);
        }
        currentIndex = newIndex;

        mainImg.style.opacity = 0;
        setTimeout(() => {
            mainImg.src = 'photos/' + imageFiles[currentIndex];
            
            // 画像の読み込みが完了してからスクロール位置をリセットし、表示する
            mainImg.onload = () => {
                // スクロールコンテナの幅と画像の幅を比較して、スクロール位置を中央に調整
                const scrollableWidth = mainImg.width - scrollContainer.clientWidth;
                if (scrollableWidth > 0) {
                    scrollContainer.scrollLeft = scrollableWidth / 2;
                } else {
                    scrollContainer.scrollLeft = 0;
                }
                mainImg.style.opacity = 1;
            };
            // もし画像がキャッシュされていてonloadが発火しない場合のための対策
            if (mainImg.complete) {
                mainImg.onload();
            }
        }, 300);
    }

    // ページ読み込み時に最初の画像を設定
    window.onload = function() {
        changeBackground();
    };
  </script>

</body>
</html>