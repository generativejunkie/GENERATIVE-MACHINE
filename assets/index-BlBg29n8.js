const g=Symbol,Le=", ",l=(()=>{const r="front",t="side",s="rear",n="left",e="center",i="right";return["",r+" ",t+" ",s+" "].map(c=>[[n,i],[n,i,e],[n,e,i],[e,n,i],[e]].flatMap(a=>a.map(f=>c+f).join(Le)))})(),j="LFE",E0="monophonic (mono)",_0="stereo",M0="surround",k=(r,...t)=>`${[E0,_0,`linear ${M0}`,"quadraphonic",`5.0 ${M0}`,`5.1 ${M0}`,`6.1 ${M0}`,`7.1 ${M0}`][r-1]} (${t.join(Le)})`,ne=[E0,k(2,l[0][0]),k(3,l[0][2]),k(4,l[1][0],l[3][0]),k(5,l[1][2],l[3][0]),k(6,l[1][2],l[3][0],j),k(7,l[1][2],l[2][0],l[3][4],j),k(8,l[1][2],l[2][0],l[3][0],j)],ts=192e3,es=176400,Ue=96e3,Ae=88200,ss=64e3,gt=48e3,oe=44100,ce=32e3,ae=24e3,le=22050,he=16e3,Re=12e3,Ne=11025,ue=8e3,ns=7350,W="absoluteGranulePosition",d="bandwidth",K="bitDepth",A="bitrate",Ht=A+"Maximum",It=A+"Minimum",Lt=A+"Nominal",O0="buffer",Ut=O0+"Fullness",v="codec",D=v+"Frames",rt="coupledStreamCount",pt="crc",De=pt+"16",Te=pt+"32",M="data",h="description",f0="duration",j0="emphasis",At="hasOpusPadding",G="header",I0="isContinuedPacket",Rt="isCopyrighted",L0="isFirstPage",Nt="isHome",J="isLastPage",m0="isOriginal",g0="isPrivate",Dt="isVbr",R="layer",o="length",b="mode",n0=b+"Extension",Ee="mpeg",y0=Ee+"Version",Tt="numberAACFrames",Et="outputGain",U0="preSkip",Ot="profile",zt=g(),S0="protection",is="rawData",i0="segments",S="subarray",A0="version",yt="vorbis",Vt=yt+"Comments",ot=yt+"Setup",St="block",Gt=St+"ingStrategy",qt=g(),t0=St+"Size",P0=St+"size0",$0=St+"size1",W0=g(),Ct="channel",e0=Ct+"MappingFamily",ct=Ct+"MappingTable",X=Ct+"Mode",J0=g(),u=Ct+"s",Oe="copyright",jt=Oe+"Id",Wt=Oe+"IdStart",c0="frame",d0=c0+"Count",Q=c0+"Length",xt="Number",R0=c0+xt,z=c0+"Padding",p=c0+"Size",ze="Rate",Jt="inputSample"+ze,be="page",at=be+"Checksum",dt=g(),H0=be+"SegmentTable",H=be+"Sequence"+xt,pe="sample",Zt=pe+xt,w=pe+ze,V=g(),y=pe+"s",wt="stream",lt=wt+"Count",Ve=wt+"Info",C0=wt+"Serial"+xt,rs=wt+"StructureVersion",de="total",ht=de+"BytesOut",ut=de+"Duration",ft=de+"Samples",F=g(),Z=g(),Z0=g(),Ft=g(),x0=g(),Ge=g(),we=g(),kt=g(),P=g(),F0=g(),a0=g(),z0=g(),vt=g(),qe=g(),o0=g(),w0=g(),k0=g(),je=g(),T=Uint8Array,Mt=DataView,m="reserved",U="bad",B0="free",fe="none",We="16bit CRC",_e=(r,t,s)=>{for(let n=0;n<r[o];n++){let e=t(n);for(let i=8;i>0;i--)e=s(e);r[n]=e}return r},os=_e(new T(256),r=>r,r=>r&128?7^r<<1:r<<1),C=[_e(new Uint16Array(256),r=>r<<8,r=>r<<1^(r&32768?32773:0))],x=[_e(new Uint32Array(256),r=>r,r=>r>>>1^(r&1)*3988292384)];for(let r=0;r<15;r++){C.push(new Uint16Array(256)),x.push(new Uint32Array(256));for(let t=0;t<=255;t++)C[r+1][t]=C[0][C[r][t]>>>8]^C[r][t]<<8,x[r+1][t]=x[r][t]>>>8^x[0][x[r][t]&255]}const cs=r=>{let t=0;const s=r[o];for(let n=0;n!==s;n++)t=os[t^r[n]];return t},as=r=>{const t=r[o],s=t-16;let n=0,e=0;for(;e<=s;)n^=r[e++]<<8|r[e++],n=C[15][n>>8]^C[14][n&255]^C[13][r[e++]]^C[12][r[e++]]^C[11][r[e++]]^C[10][r[e++]]^C[9][r[e++]]^C[8][r[e++]]^C[7][r[e++]]^C[6][r[e++]]^C[5][r[e++]]^C[4][r[e++]]^C[3][r[e++]]^C[2][r[e++]]^C[1][r[e++]]^C[0][r[e++]];for(;e!==t;)n=(n&255)<<8^C[0][n>>8^r[e++]];return n},ls=r=>{const t=r[o],s=t-16;let n=0,e=0;for(;e<=s;)n=x[15][(r[e++]^n)&255]^x[14][(r[e++]^n>>>8)&255]^x[13][(r[e++]^n>>>16)&255]^x[12][r[e++]^n>>>24]^x[11][r[e++]]^x[10][r[e++]]^x[9][r[e++]]^x[8][r[e++]]^x[7][r[e++]]^x[6][r[e++]]^x[5][r[e++]]^x[4][r[e++]]^x[3][r[e++]]^x[2][r[e++]]^x[1][r[e++]]^x[0][r[e++]];for(;e!==t;)n=x[0][(n^r[e++])&255]^n>>>8;return n^-1},ie=(...r)=>{const t=new T(r.reduce((s,n)=>s+n[o],0));return r.reduce((s,n)=>(t.set(n,s),s+n[o]),0),t},l0=r=>String.fromCharCode(...r),Fe=[0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15],_t=r=>Fe[r&15]<<4|Fe[r>>4];class hs{constructor(t){this._data=t,this._pos=t[o]*8}set position(t){this._pos=t}get position(){return this._pos}read(t){const s=Math.floor(this._pos/8),n=this._pos%8;return this._pos-=t,(_t(this._data[s-1])<<8)+_t(this._data[s])>>7-n&255}}const us=(r,t)=>{try{return r.getBigInt64(t,!0)}catch{const s=r.getUint8(t+7)&128?-1:1;let n=r.getUint32(t,!0),e=r.getUint32(t+4,!0);return s===-1&&(n=~n+1,e=~e+1),e>1048575&&console.warn("This platform does not support BigInt"),s*(n+e*2**32)}};class bs{constructor(t,s){this._onCodecHeader=t,this._onCodecUpdate=s,this[o0]()}[w0](){this._isEnabled=!0}[o0](){this._headerCache=new Map,this._codecUpdateData=new WeakMap,this._codecHeaderSent=!1,this._codecShouldUpdate=!1,this._bitrate=null,this._isEnabled=!1}[qe](t,s){if(this._onCodecUpdate){this._bitrate!==t&&(this._bitrate=t,this._codecShouldUpdate=!0);const n=this._codecUpdateData.get(this._headerCache.get(this._currentHeader));this._codecShouldUpdate&&n&&this._onCodecUpdate({bitrate:t,...n},s),this._codecShouldUpdate=!1}}[P](t){const s=this._headerCache.get(t);return s&&this._updateCurrentHeader(t),s}[F0](t,s,n){this._isEnabled&&(this._codecHeaderSent||(this._onCodecHeader({...s}),this._codecHeaderSent=!0),this._updateCurrentHeader(t),this._headerCache.set(t,s),this._codecUpdateData.set(s,n))}_updateCurrentHeader(t){this._onCodecUpdate&&t!==this._currentHeader&&(this._codecShouldUpdate=!0,this._currentHeader=t)}}const N=new WeakMap,Y=new WeakMap;class v0{constructor(t,s){this._codecParser=t,this._headerCache=s}*[we](){let t;do{if(t=yield*this.Frame[a0](this._codecParser,this._headerCache,0),t)return t;this._codecParser[Z](1)}while(!0)}*[kt](t){let s=yield*this[we]();const n=Y.get(s)[o];if(t||this._codecParser._flushing||(yield*this.Header[P](this._codecParser,this._headerCache,n)))return this._headerCache[w0](),this._codecParser[Z](n),this._codecParser[Ft](s),s;this._codecParser[x0](`Missing ${c0} at ${n} bytes from current position.`,`Dropping current ${c0} and trying again.`),this._headerCache[o0](),this._codecParser[Z](1)}}class Je{constructor(t,s){Y.set(this,{[G]:t}),this[M]=s}}class V0 extends Je{static*[a0](t,s,n,e,i){const c=yield*t[P](n,e,i);if(c){const a=N.get(c)[Q],f=N.get(c)[y],_=(yield*n[F](a,i))[S](0,a);return new s(c,_,f)}else return null}constructor(t,s,n){super(t,s),this[G]=t,this[y]=n,this[f0]=n/t[w]*1e3,this[R0]=null,this[ht]=null,this[ft]=null,this[ut]=null,Y.get(this)[o]=s[o]}}const Kt="unsynchronizationFlag",Xt="extendedHeaderFlag",Qt="experimentalFlag",Yt="footerPresent";class me{static*getID3v2Header(t,s,n){const i={};let c=yield*t[F](3,n);if(c[0]!==73||c[1]!==68||c[2]!==51||(c=yield*t[F](10,n),i[A0]=`id3v2.${c[3]}.${c[4]}`,c[5]&15)||(i[Kt]=!!(c[5]&128),i[Xt]=!!(c[5]&64),i[Qt]=!!(c[5]&32),i[Yt]=!!(c[5]&16),c[6]&128||c[7]&128||c[8]&128||c[9]&128))return null;const a=c[6]<<21|c[7]<<14|c[8]<<7|c[9];return i[o]=10+a,new me(i)}constructor(t){this[A0]=t[A0],this[Kt]=t[Kt],this[Xt]=t[Xt],this[Qt]=t[Qt],this[Yt]=t[Yt],this[o]=t[o]}}class G0{constructor(t){N.set(this,t),this[K]=t[K],this[A]=null,this[u]=t[u],this[X]=t[X],this[w]=t[w]}}const Ze={0:[B0,B0,B0,B0,B0],16:[32,32,32,32,8],240:[U,U,U,U,U]},K0=(r,t,s)=>8*((r+s)%t+t)*(1<<(r+s)/t)-8*t*(t/8|0);for(let r=2;r<15;r++)Ze[r<<4]=[r*32,K0(r,4,0),K0(r,4,-1),K0(r,8,4),K0(r,8,0)];const ps=0,ds=1,fs=2,_s=3,ke=4,X0="bands ",Q0=" to 31",ve={0:X0+4+Q0,16:X0+8+Q0,32:X0+12+Q0,48:X0+16+Q0},s0="bitrateIndex",N0="v2",bt="v1",Y0="Intensity stereo ",tt=", MS stereo ",et="on",st="off",ms={0:Y0+st+tt+st,16:Y0+et+tt+st,32:Y0+st+tt+et,48:Y0+et+tt+et},te={0:{[h]:m},2:{[h]:"Layer III",[z]:1,[n0]:ms,[bt]:{[s0]:fs,[y]:1152},[N0]:{[s0]:ke,[y]:576}},4:{[h]:"Layer II",[z]:1,[n0]:ve,[y]:1152,[bt]:{[s0]:ds},[N0]:{[s0]:ke}},6:{[h]:"Layer I",[z]:4,[n0]:ve,[y]:384,[bt]:{[s0]:ps},[N0]:{[s0]:_s}}},ee="MPEG Version ",Me="ISO/IEC ",gs={0:{[h]:`${ee}2.5 (later extension of MPEG 2)`,[R]:N0,[w]:{0:Ne,4:Re,8:ue,12:m}},8:{[h]:m},16:{[h]:`${ee}2 (${Me}13818-3)`,[R]:N0,[w]:{0:le,4:ae,8:he,12:m}},24:{[h]:`${ee}1 (${Me}11172-3)`,[R]:bt,[w]:{0:oe,4:gt,8:ce,12:m}},length:o},ys={0:We,1:fe},Ss={0:fe,1:"50/15 ms",2:m,3:"CCIT J.17"},Be={0:{[u]:2,[h]:_0},64:{[u]:2,[h]:"joint "+_0},128:{[u]:2,[h]:"dual channel"},192:{[u]:1,[h]:E0}};class D0 extends G0{static*[P](t,s,n){const e={},i=yield*me.getID3v2Header(t,s,n);i&&(yield*t[F](i[o],n),t[Z](i[o]));const c=yield*t[F](4,n),a=l0(c[S](0,4)),f=s[P](a);if(f)return new D0(f);if(c[0]!==255||c[1]<224)return null;const _=gs[c[1]&24];if(_[h]===m)return null;const $=c[1]&6;if(te[$][h]===m)return null;const I={...te[$],...te[$][_[R]]};if(e[y0]=_[h],e[R]=I[h],e[y]=I[y],e[S0]=ys[c[1]&1],e[o]=4,e[A]=Ze[c[2]&240][I[s0]],e[A]===U||(e[w]=_[w][c[2]&12],e[w]===m)||(e[z]=c[2]&2&&I[z],e[g0]=!!(c[2]&1),e[Q]=Math.floor(125*e[A]*e[y]/e[w]+e[z]),!e[Q]))return null;const h0=c[3]&192;if(e[X]=Be[h0][h],e[u]=Be[h0][u],e[n0]=I[n0][c[3]&48],e[Rt]=!!(c[3]&8),e[m0]=!!(c[3]&4),e[j0]=Ss[c[3]&3],e[j0]===m)return null;e[K]=16;{const{length:q0,frameLength:u0,samples:Ce,...$t}=e;s[F0](a,e,$t)}return new D0(e)}constructor(t){super(t),this[A]=t[A],this[j0]=t[j0],this[z]=t[z],this[Rt]=t[Rt],this[m0]=t[m0],this[g0]=t[g0],this[R]=t[R],this[n0]=t[n0],this[y0]=t[y0],this[S0]=t[S0]}}class ge extends V0{static*[a0](t,s,n){return yield*super[a0](D0,ge,t,s,n)}constructor(t,s,n){super(t,s,n)}}class Cs extends v0{constructor(t,s,n){super(t,s),this.Frame=ge,this.Header=D0,n(this[v])}get[v](){return Ee}*[z0](){return yield*this[kt]()}}const xs={0:"MPEG-4",8:"MPEG-2"},ws={0:"valid",2:U,4:U,6:U},Fs={0:We,1:fe},ks={0:"AAC Main",64:"AAC LC (Low Complexity)",128:"AAC SSR (Scalable Sample Rate)",192:"AAC LTP (Long Term Prediction)"},vs={0:Ue,4:Ae,8:ss,12:gt,16:oe,20:ce,24:ae,28:le,32:he,36:Re,40:Ne,44:ue,48:ns,52:m,56:m,60:"frequency is written explicitly"},Pe={0:{[u]:0,[h]:"Defined in AOT Specific Config"},64:{[u]:1,[h]:E0},128:{[u]:2,[h]:k(2,l[0][0])},192:{[u]:3,[h]:k(3,l[1][3])},256:{[u]:4,[h]:k(4,l[1][3],l[3][4])},320:{[u]:5,[h]:k(5,l[1][3],l[3][0])},384:{[u]:6,[h]:k(6,l[1][3],l[3][0],j)},448:{[u]:8,[h]:k(8,l[1][3],l[2][0],l[3][0],j)}};class Bt extends G0{static*[P](t,s,n){const e={},i=yield*t[F](7,n),c=l0([i[0],i[1],i[2],i[3]&252|i[6]&3]),a=s[P](c);if(a)Object.assign(e,a);else{if(i[0]!==255||i[1]<240||(e[y0]=xs[i[1]&8],e[R]=ws[i[1]&6],e[R]===U))return null;const _=i[1]&1;e[S0]=Fs[_],e[o]=_?7:9,e[zt]=i[2]&192,e[V]=i[2]&60;const $=i[2]&2;if(e[Ot]=ks[e[zt]],e[w]=vs[e[V]],e[w]===m)return null;e[g0]=!!$,e[J0]=(i[2]<<8|i[3])&448,e[X]=Pe[e[J0]][h],e[u]=Pe[e[J0]][u],e[m0]=!!(i[3]&32),e[Nt]=!!(i[3]&8),e[jt]=!!(i[3]&8),e[Wt]=!!(i[3]&4),e[K]=16,e[y]=1024,e[Tt]=i[6]&3;{const{length:I,channelModeBits:h0,profileBits:q0,sampleRateBits:u0,frameLength:Ce,samples:$t,numberAACFrames:xe,...Ye}=e;s[F0](c,e,Ye)}}if(e[Q]=(i[3]<<11|i[4]<<3|i[5]>>5)&8191,!e[Q])return null;const f=(i[5]<<6|i[6]>>2)&2047;return e[Ut]=f===2047?"VBR":f,new Bt(e)}constructor(t){super(t),this[jt]=t[jt],this[Wt]=t[Wt],this[Ut]=t[Ut],this[Nt]=t[Nt],this[m0]=t[m0],this[g0]=t[g0],this[R]=t[R],this[o]=t[o],this[y0]=t[y0],this[Tt]=t[Tt],this[Ot]=t[Ot],this[S0]=t[S0]}get audioSpecificConfig(){const t=N.get(this),s=t[zt]+64<<5|t[V]<<5|t[J0]>>3,n=new T(2);return new Mt(n[O0]).setUint16(0,s,!1),n}}class ye extends V0{static*[a0](t,s,n){return yield*super[a0](Bt,ye,t,s,n)}constructor(t,s,n){super(t,s,n)}}class Ms extends v0{constructor(t,s,n){super(t,s),this.Frame=ye,this.Header=Bt,n(this[v])}get[v](){return"aac"}*[z0](){return yield*this[kt]()}}class r0 extends V0{static _getFrameFooterCrc16(t){return(t[t[o]-2]<<8)+t[t[o]-1]}static[je](t){const s=r0._getFrameFooterCrc16(t),n=as(t[S](0,-2));return s===n}constructor(t,s,n){s[Ve]=n,s[De]=r0._getFrameFooterCrc16(t),super(s,t,N.get(s)[y])}}const Ke="get from STREAMINFO metadata block",Bs={0:"Fixed",1:"Variable"},Xe={0:m,16:192};for(let r=2;r<16;r++)Xe[r<<4]=r<6?576*2**(r-2):2**r;const Ps={0:Ke,1:Ae,2:es,3:ts,4:ue,5:he,6:le,7:ae,8:ce,9:oe,10:gt,11:Ue,15:U},$s={0:{[u]:1,[h]:E0},16:{[u]:2,[h]:k(2,l[0][0])},32:{[u]:3,[h]:k(3,l[0][1])},48:{[u]:4,[h]:k(4,l[1][0],l[3][0])},64:{[u]:5,[h]:k(5,l[1][1],l[3][0])},80:{[u]:6,[h]:k(6,l[1][1],j,l[3][0])},96:{[u]:7,[h]:k(7,l[1][1],j,l[3][4],l[2][0])},112:{[u]:8,[h]:k(8,l[1][1],j,l[3][0],l[2][0])},128:{[u]:2,[h]:`${_0} (left, diff)`},144:{[u]:2,[h]:`${_0} (diff, right)`},160:{[u]:2,[h]:`${_0} (avg, diff)`},176:m,192:m,208:m,224:m,240:m},Hs={0:Ke,2:8,4:12,6:m,8:16,10:20,12:24,14:m};class q extends G0{static _decodeUTF8Int(t){if(t[0]>254)return null;if(t[0]<128)return{value:t[0],length:1};let s=1;for(let c=64;c&t[0];c>>=1)s++;let n=s-1,e=0,i=0;for(;n>0;i+=6,n--){if((t[n]&192)!==128)return null;e|=(t[n]&63)<<i}return e|=(t[n]&127>>s)<<i,{value:e,length:s}}static[k0](t,s){const n={[F]:function*(){return t}};return q[P](n,s,0).next().value}static*[P](t,s,n){let e=yield*t[F](6,n);if(e[0]!==255||!(e[1]===248||e[1]===249))return null;const i={},c=l0(e[S](0,4)),a=s[P](c);if(a)Object.assign(i,a);else{if(i[qt]=e[1]&1,i[Gt]=Bs[i[qt]],i[W0]=e[2]&240,i[V]=e[2]&15,i[t0]=Xe[i[W0]],i[t0]===m||(i[w]=Ps[i[V]],i[w]===U)||e[3]&1)return null;const _=$s[e[3]&240];if(_===m||(i[u]=_[u],i[X]=_[h],i[K]=Hs[e[3]&14],i[K]===m))return null}i[o]=5,e=yield*t[F](i[o]+8,n);const f=q._decodeUTF8Int(e[S](4));if(!f||(i[qt]?i[Zt]=f.value:i[R0]=f.value,i[o]+=f[o],i[W0]===96?(e[o]<i[o]&&(e=yield*t[F](i[o],n)),i[t0]=e[i[o]-1]+1,i[o]+=1):i[W0]===112&&(e[o]<i[o]&&(e=yield*t[F](i[o],n)),i[t0]=(e[i[o]-1]<<8)+e[i[o]]+1,i[o]+=2),i[y]=i[t0],i[V]===12?(e[o]<i[o]&&(e=yield*t[F](i[o],n)),i[w]=e[i[o]-1]*1e3,i[o]+=1):i[V]===13?(e[o]<i[o]&&(e=yield*t[F](i[o],n)),i[w]=(e[i[o]-1]<<8)+e[i[o]],i[o]+=2):i[V]===14&&(e[o]<i[o]&&(e=yield*t[F](i[o],n)),i[w]=((e[i[o]-1]<<8)+e[i[o]])*10,i[o]+=2),e[o]<i[o]&&(e=yield*t[F](i[o],n)),i[pt]=e[i[o]-1],i[pt]!==cs(e[S](0,i[o]-1))))return null;if(!a){const{blockingStrategyBits:_,frameNumber:$,sampleNumber:I,samples:h0,sampleRateBits:q0,blockSizeBits:u0,crc:Ce,length:$t,...xe}=i;s[F0](c,i,xe)}return new q(i)}constructor(t){super(t),this[De]=null,this[Gt]=t[Gt],this[t0]=t[t0],this[R0]=t[R0],this[Zt]=t[Zt],this[Ve]=null}}const Is=2,Ls=512*1024;class Qe extends v0{constructor(t,s,n){super(t,s),this.Frame=r0,this.Header=q,n(this[v])}get[v](){return"flac"}*_getNextFrameSyncOffset(t){const s=yield*this._codecParser[F](2,0),n=s[o]-2;for(;t<n;){if(s[t]===255){const i=s[t+1];if(i===248||i===249)break;i!==255&&t++}t++}return t}*[z0](){do{const t=yield*q[P](this._codecParser,this._headerCache,0);if(t){let s=N.get(t)[o]+Is;for(;s<=Ls;){if(this._codecParser._flushing||(yield*q[P](this._codecParser,this._headerCache,s))){let n=yield*this._codecParser[F](s);if(this._codecParser._flushing||(n=n[S](0,s)),r0[je](n)){const e=new r0(n,t);return this._headerCache[w0](),this._codecParser[Z](s),this._codecParser[Ft](e),e}}s=yield*this._getNextFrameSyncOffset(s+1)}this._codecParser[x0](`Unable to sync FLAC frame after searching ${s} bytes.`),this._codecParser[Z](s)}else this._codecParser[Z](yield*this._getNextFrameSyncOffset(1))}while(!0)}[vt](t){return t[H]===0?(this._headerCache[w0](),this._streamInfo=t[M][S](13)):t[H]===1||(t[D]=Y.get(t)[i0].map(s=>{const n=q[k0](s,this._headerCache);if(n)return new r0(s,n,this._streamInfo);this._codecParser[x0]("Failed to parse Ogg FLAC frame","Skipping invalid FLAC frame")}).filter(s=>!!s)),t}}class Pt{static*[P](t,s,n){const e={};let i=yield*t[F](28,n);if(i[0]!==79||i[1]!==103||i[2]!==103||i[3]!==83||(e[rs]=i[4],i[5]&248))return null;e[J]=!!(i[5]&4),e[L0]=!!(i[5]&2),e[I0]=!!(i[5]&1);const a=new Mt(T.from(i[S](0,28))[O0]);e[W]=us(a,6),e[C0]=a.getInt32(14,!0),e[H]=a.getInt32(18,!0),e[at]=a.getInt32(22,!0);const f=i[26];e[o]=f+27,i=yield*t[F](e[o],n),e[Q]=0,e[H0]=[],e[dt]=T.from(i[S](27,e[o]));for(let _=0,$=0;_<f;_++){const I=e[dt][_];e[Q]+=I,$+=I,(I!==255||_===f-1)&&(e[H0].push($),$=0)}return new Pt(e)}constructor(t){N.set(this,t),this[W]=t[W],this[I0]=t[I0],this[L0]=t[L0],this[J]=t[J],this[H0]=t[H0],this[H]=t[H],this[at]=t[at],this[C0]=t[C0]}}class Se extends Je{static*[a0](t,s,n){const e=yield*Pt[P](t,s,n);if(e){const i=N.get(e)[Q],c=N.get(e)[o],a=c+i,f=(yield*t[F](a,0))[S](0,a),_=f[S](c,a);return new Se(e,_,f)}else return null}constructor(t,s,n){super(t,s),Y.get(this)[o]=n[o],this[D]=[],this[is]=n,this[W]=t[W],this[Te]=t[at],this[f0]=0,this[I0]=t[I0],this[L0]=t[L0],this[J]=t[J],this[H]=t[H],this[y]=0,this[C0]=t[C0]}}class $e extends V0{constructor(t,s,n){super(s,t,n)}}const He={0:ne.slice(0,2),1:ne},L="SILK-only",B="CELT-only",nt="Hybrid",E="narrowband",it="medium-band",O="wideband",b0="super-wideband",p0="fullband",Us={0:{[b]:L,[d]:E,[p]:10},8:{[b]:L,[d]:E,[p]:20},16:{[b]:L,[d]:E,[p]:40},24:{[b]:L,[d]:E,[p]:60},32:{[b]:L,[d]:it,[p]:10},40:{[b]:L,[d]:it,[p]:20},48:{[b]:L,[d]:it,[p]:40},56:{[b]:L,[d]:it,[p]:60},64:{[b]:L,[d]:O,[p]:10},72:{[b]:L,[d]:O,[p]:20},80:{[b]:L,[d]:O,[p]:40},88:{[b]:L,[d]:O,[p]:60},96:{[b]:nt,[d]:b0,[p]:10},104:{[b]:nt,[d]:b0,[p]:20},112:{[b]:nt,[d]:p0,[p]:10},120:{[b]:nt,[d]:p0,[p]:20},128:{[b]:B,[d]:E,[p]:2.5},136:{[b]:B,[d]:E,[p]:5},144:{[b]:B,[d]:E,[p]:10},152:{[b]:B,[d]:E,[p]:20},160:{[b]:B,[d]:O,[p]:2.5},168:{[b]:B,[d]:O,[p]:5},176:{[b]:B,[d]:O,[p]:10},184:{[b]:B,[d]:O,[p]:20},192:{[b]:B,[d]:b0,[p]:2.5},200:{[b]:B,[d]:b0,[p]:5},208:{[b]:B,[d]:b0,[p]:10},216:{[b]:B,[d]:b0,[p]:20},224:{[b]:B,[d]:p0,[p]:2.5},232:{[b]:B,[d]:p0,[p]:5},240:{[b]:B,[d]:p0,[p]:10},248:{[b]:B,[d]:p0,[p]:20}};class T0 extends G0{static[k0](t,s,n){const e={};if(e[u]=t[9],e[e0]=t[18],e[o]=e[e0]!==0?21+e[u]:19,t[o]<e[o])throw new Error("Out of data while inside an Ogg Page");const i=s[0]&3,c=i===3?2:1,a=l0(t[S](0,e[o]))+l0(s[S](0,c)),f=n[P](a);if(f)return new T0(f);if(a.substr(0,8)!=="OpusHead"||t[8]!==1)return null;e[M]=T.from(t[S](0,e[o]));const _=new Mt(e[M][O0]);if(e[K]=16,e[U0]=_.getUint16(10,!0),e[Jt]=_.getUint32(12,!0),e[w]=gt,e[Et]=_.getInt16(16,!0),e[e0]in He&&(e[X]=He[e[e0]][e[u]-1],!e[X]))return null;e[e0]!==0&&(e[lt]=t[19],e[rt]=t[20],e[ct]=[...t[S](21,e[u]+21)]);const $=Us[248&s[0]];switch(e[b]=$[b],e[d]=$[d],e[p]=$[p],i){case 0:e[d0]=1;break;case 1:case 2:e[d0]=2;break;case 3:e[Dt]=!!(128&s[1]),e[At]=!!(64&s[1]),e[d0]=63&s[1];break;default:return null}{const{length:I,data:h0,channelMappingFamily:q0,...u0}=e;n[F0](a,e,u0)}return new T0(e)}constructor(t){super(t),this[M]=t[M],this[d]=t[d],this[e0]=t[e0],this[ct]=t[ct],this[rt]=t[rt],this[d0]=t[d0],this[p]=t[p],this[At]=t[At],this[Jt]=t[Jt],this[Dt]=t[Dt],this[b]=t[b],this[Et]=t[Et],this[U0]=t[U0],this[lt]=t[lt]}}class As extends v0{constructor(t,s,n){super(t,s),this.Frame=$e,this.Header=T0,n(this[v]),this._identificationHeader=null,this._preSkipRemaining=null}get[v](){return"opus"}[vt](t){return t[H]===0?(this._headerCache[w0](),this._identificationHeader=t[M]):t[H]===1||(t[D]=Y.get(t)[i0].map(s=>{const n=T0[k0](this._identificationHeader,s,this._headerCache);if(n){this._preSkipRemaining===null&&(this._preSkipRemaining=n[U0]);let e=n[p]*n[d0]/1e3*n[w];return this._preSkipRemaining>0&&(this._preSkipRemaining-=e,e=this._preSkipRemaining<0?-this._preSkipRemaining:0),new $e(s,n,e)}this._codecParser[Ge]("Failed to parse Ogg Opus Header","Not a valid Ogg Opus file")})),t}}class Ie extends V0{constructor(t,s,n){super(s,t,n)}}const re={};for(let r=0;r<8;r++)re[r+6]=2**(6+r);class mt extends G0{static[k0](t,s,n,e){if(t[o]<30)throw new Error("Out of data while inside an Ogg Page");const i=l0(t[S](0,30)),c=s[P](i);if(c)return new mt(c);const a={[o]:30};if(i.substr(0,7)!=="vorbis")return null;a[M]=T.from(t[S](0,30));const f=new Mt(a[M][O0]);if(a[A0]=f.getUint32(7,!0),a[A0]!==0||(a[u]=t[11],a[X]=ne[a[u]-1]||"application defined",a[w]=f.getUint32(12,!0),a[Ht]=f.getInt32(16,!0),a[Lt]=f.getInt32(20,!0),a[It]=f.getInt32(24,!0),a[$0]=re[(t[28]&240)>>4],a[P0]=re[t[28]&15],a[P0]>a[$0])||t[29]!==1)return null;a[K]=32,a[ot]=e,a[Vt]=n;{const{length:_,data:$,version:I,vorbisSetup:h0,vorbisComments:q0,...u0}=a;s[F0](i,a,u0)}return new mt(a)}constructor(t){super(t),this[Ht]=t[Ht],this[It]=t[It],this[Lt]=t[Lt],this[P0]=t[P0],this[$0]=t[$0],this[M]=t[M],this[Vt]=t[Vt],this[ot]=t[ot]}}class Rs extends v0{constructor(t,s,n){super(t,s),this.Frame=Ie,n(this[v]),this._identificationHeader=null,this._setupComplete=!1,this._prevBlockSize=null}get[v](){return yt}[vt](t){t[D]=[];for(const s of Y.get(t)[i0])if(s[0]===1)this._headerCache[w0](),this._identificationHeader=t[M],this._setupComplete=!1;else if(s[0]===3)this._vorbisComments=s;else if(s[0]===5)this._vorbisSetup=s,this._mode=this._parseSetupHeader(s),this._setupComplete=!0;else if(this._setupComplete){const n=mt[k0](this._identificationHeader,this._headerCache,this._vorbisComments,this._vorbisSetup);n?t[D].push(new Ie(s,n,this._getSamples(s,n))):this._codecParser[logError]("Failed to parse Ogg Vorbis Header","Not a valid Ogg Vorbis file")}return t}_getSamples(t,s){const e=this._mode.blockFlags[t[0]>>1&this._mode.mask]?s[$0]:s[P0],i=this._prevBlockSize===null?0:(this._prevBlockSize+e)/4;return this._prevBlockSize=e,i}_parseSetupHeader(t){const s=new hs(t),n={count:0,blockFlags:[]};for(;(s.read(1)&1)!==1;);let e;for(;n.count<64&&s.position>0;){_t(s.read(8));let i=0;for(;s.read(8)===0&&i++<3;);if(i===4)e=s.read(7),n.blockFlags.unshift(e&1),s.position+=6,n.count++;else{((_t(e)&126)>>1)+1!==n.count&&this._codecParser[x0]("vorbis derived mode count did not match actual mode count");break}}return n.mask=(1<<Math.log2(n.count))-1,n}}class Ns{constructor(t,s,n){this._codecParser=t,this._headerCache=s,this._onCodec=n,this._continuedPacket=new T,this._codec=null,this._isSupported=null,this._previousAbsoluteGranulePosition=null}get[v](){return this._codec||""}_updateCodec(t,s){this._codec!==t&&(this._headerCache[o0](),this._parser=new s(this._codecParser,this._headerCache,this._onCodec),this._codec=t)}_checkCodecSupport({data:t}){const s=l0(t[S](0,8));switch(s){case"fishead\0":return!1;case"OpusHead":return this._updateCodec("opus",As),!0;case(/^\x7fFLAC/.test(s)&&s):return this._updateCodec("flac",Qe),!0;case(/^\x01vorbis/.test(s)&&s):return this._updateCodec(yt,Rs),!0;default:return!1}}_checkPageSequenceNumber(t){t[H]!==this._pageSequenceNumber+1&&this._pageSequenceNumber>1&&t[H]>1&&this._codecParser[x0]("Unexpected gap in Ogg Page Sequence Number.",`Expected: ${this._pageSequenceNumber+1}, Got: ${t[H]}`),this._pageSequenceNumber=t[H]}_parsePage(t){this._isSupported===null&&(this._pageSequenceNumber=t[H],this._isSupported=this._checkCodecSupport(t)),this._checkPageSequenceNumber(t);const s=Y.get(t),n=N.get(s[G]);let e=0;if(s[i0]=n[H0].map(i=>t[M][S](e,e+=i)),this._continuedPacket[o]&&(s[i0][0]=ie(this._continuedPacket,s[i0][0]),this._continuedPacket=new T),n[dt][n[dt][o]-1]===255&&(this._continuedPacket=ie(this._continuedPacket,s[i0].pop())),this._previousAbsoluteGranulePosition!==null&&(t[y]=Number(t[W]-this._previousAbsoluteGranulePosition)),this._previousAbsoluteGranulePosition=t[W],this._isSupported){const i=this._parser[vt](t);return this._codecParser[Ft](i),i}else return t}}class Ds extends v0{constructor(t,s,n){super(t,s),this._onCodec=n,this.Frame=Se,this.Header=Pt,this._streams=new Map,this._currentSerialNumber=null}get[v](){const t=this._streams.get(this._currentSerialNumber);return t?t.codec:""}*[z0](){const t=yield*this[kt](!0);this._currentSerialNumber=t[C0];let s=this._streams.get(this._currentSerialNumber);return s||(s=new Ns(this._codecParser,this._headerCache,this._onCodec),this._streams.set(this._currentSerialNumber,s)),t[J]&&this._streams.delete(this._currentSerialNumber),s._parsePage(t)}}const se=()=>{};class Ts{constructor(t,{onCodec:s,onCodecHeader:n,onCodecUpdate:e,enableLogging:i=!1,enableFrameCRC32:c=!0}={}){this._inputMimeType=t,this._onCodec=s||se,this._onCodecHeader=n||se,this._onCodecUpdate=e,this._enableLogging=i,this._crc32=c?ls:se,this[o0]()}get[v](){return this._parser?this._parser[v]:""}[o0](){this._headerCache=new bs(this._onCodecHeader,this._onCodecUpdate),this._generator=this._getGenerator(),this._generator.next()}*flush(){this._flushing=!0;for(let t=this._generator.next();t.value;t=this._generator.next())yield t.value;this._flushing=!1,this[o0]()}*parseChunk(t){for(let s=this._generator.next(t);s.value;s=this._generator.next())yield s.value}parseAll(t){return[...this.parseChunk(t),...this.flush()]}*_getGenerator(){if(this._inputMimeType.match(/aac/))this._parser=new Ms(this,this._headerCache,this._onCodec);else if(this._inputMimeType.match(/mpeg/))this._parser=new Cs(this,this._headerCache,this._onCodec);else if(this._inputMimeType.match(/flac/))this._parser=new Qe(this,this._headerCache,this._onCodec);else if(this._inputMimeType.match(/ogg/))this._parser=new Ds(this,this._headerCache,this._onCodec);else throw new Error(`Unsupported Codec ${mimeType}`);for(this._frameNumber=0,this._currentReadPosition=0,this._totalBytesIn=0,this._totalBytesOut=0,this._totalSamples=0,this._sampleRate=void 0,this._rawData=new Uint8Array(0);;){const t=yield*this._parser[z0]();t&&(yield t)}}*[F](t=0,s=0){let n;for(;this._rawData[o]<=t+s;){if(n=yield,this._flushing)return this._rawData[S](s);n&&(this._totalBytesIn+=n[o],this._rawData=ie(this._rawData,n))}return this._rawData[S](s)}[Z](t){this._currentReadPosition+=t,this._rawData=this._rawData[S](t)}[Z0](t){this._sampleRate=t[G][w],t[G][A]=t[f0]>0?Math.round(t[M][o]/t[f0])*8:0,t[R0]=this._frameNumber++,t[ht]=this._totalBytesOut,t[ft]=this._totalSamples,t[ut]=this._totalSamples/this._sampleRate*1e3,t[Te]=this._crc32(t[M]),this._headerCache[qe](t[G][A],t[ut]),this._totalBytesOut+=t[M][o],this._totalSamples+=t[y]}[Ft](t){if(t[D]){if(t[J]){let s=t[y];t[D].forEach(n=>{const e=n[y];s<e&&(n[y]=s>0?s:0,n[f0]=n[y]/n[G][w]*1e3),s-=e,this[Z0](n)})}else t[y]=0,t[D].forEach(s=>{t[y]+=s[y],this[Z0](s)});t[f0]=t[y]/this._sampleRate*1e3||0,t[ft]=this._totalSamples,t[ut]=this._totalSamples/this._sampleRate*1e3||0,t[ht]=this._totalBytesOut}else this[Z0](t)}_log(t,s){if(this._enableLogging){const n=[`${v}:         ${this[v]}`,`inputMimeType: ${this._inputMimeType}`,`readPosition:  ${this._currentReadPosition}`,`totalBytesIn:  ${this._totalBytesIn}`,`${ht}: ${this._totalBytesOut}`],e=Math.max(...n.map(i=>i[o]));s.push(`--stats--${"-".repeat(e-9)}`,...n,"-".repeat(e)),t("codec-parser",s.reduce((i,c)=>i+`
  `+c,""))}}[x0](...t){this._log(console.warn,t)}[Ge](...t){this._log(console.error,t)}}const Es=W,Os=D,zs=rt,Vs=M,Gs=G,qs=J,js=U0,Ws=ot,Js=ct,Zs=u,Ks=lt,Xs=ft;export{Ts as C,Zs as a,Js as b,Os as c,Vs as d,zs as e,Es as f,Gs as h,qs as i,js as p,Ks as s,Xs as t,Ws as v};
//# sourceMappingURL=index-BlBg29n8.js.map
